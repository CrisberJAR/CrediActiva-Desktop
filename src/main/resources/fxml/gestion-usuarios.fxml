<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<BorderPane xmlns="http://javafx.com/javafx/17.0.2-ea" xmlns:fx="http://javafx.com/fxml/1" fx:controller="pe.crediactiva.controller.GestionUsuariosController">
   <!-- Barra superior -->
   <top>
      <HBox alignment="CENTER_LEFT" style="-fx-background-color: #2c5aa0; -fx-padding: 15;">
         <children>
            <Label style="-fx-text-fill: white; -fx-font-size: 18px; -fx-font-weight: bold;" text="CrediActiva - GestiÃ³n de Usuarios" />
            <Region HBox.hgrow="ALWAYS" />
            <Button fx:id="volverButton" onAction="#handleVolver" style="-fx-background-color: #1a4480; -fx-text-fill: white; -fx-padding: 8 15;" text="â† Volver al Dashboard" />
         </children>
      </HBox>
   </top>
   
   <center>
      <VBox spacing="20.0" style="-fx-padding: 20;">
         <children>
            <!-- TÃ­tulo y estadÃ­sticas -->
            <HBox alignment="CENTER_LEFT" spacing="20.0">
               <children>
                  <VBox spacing="5.0">
                     <children>
                        <Label style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2c5aa0;" text="GestiÃ³n de Usuarios" />
                        <Label style="-fx-font-size: 14px; -fx-text-fill: #666666;" text="Administrar usuarios del sistema" />
                     </children>
                  </VBox>
                  <Region HBox.hgrow="ALWAYS" />
                  
                  <!-- EstadÃ­sticas rÃ¡pidas -->
                  <HBox spacing="15.0">
                     <children>
                        <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #e8f4fd; -fx-background-radius: 8; -fx-padding: 15;">
                           <children>
                              <Label style="-fx-font-size: 12px; -fx-text-fill: #666666;" text="Total Usuarios" />
                              <Label fx:id="totalUsuariosLabel" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #2c5aa0;" text="0" />
                           </children>
                        </VBox>
                        <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #e8f5e8; -fx-background-radius: 8; -fx-padding: 15;">
                           <children>
                              <Label style="-fx-font-size: 12px; -fx-text-fill: #666666;" text="Usuarios Activos" />
                              <Label fx:id="usuariosActivosLabel" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #28a745;" text="0" />
                           </children>
                        </VBox>
                        <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #ffeaa7; -fx-background-radius: 8; -fx-padding: 15;">
                           <children>
                              <Label style="-fx-font-size: 12px; -fx-text-fill: #666666;" text="Usuarios Inactivos" />
                              <Label fx:id="usuariosInactivosLabel" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #ffc107;" text="0" />
                           </children>
                        </VBox>
                     </children>
                  </HBox>
               </children>
            </HBox>
            
            <Separator />
            
            <!-- Barra de herramientas y filtros -->
            <VBox spacing="15.0">
               <children>
                  <!-- Botones de acciÃ³n -->
                  <HBox alignment="CENTER_LEFT" spacing="15.0">
                     <children>
                        <Button fx:id="nuevoUsuarioButton" onAction="#handleNuevoUsuario" style="-fx-background-color: #28a745; -fx-text-fill: white; -fx-padding: 10 20; -fx-font-weight: bold;" text="âž• Nuevo Usuario" />
                        <Button fx:id="editarUsuarioButton" onAction="#handleEditarUsuario" disable="true" style="-fx-background-color: #007bff; -fx-text-fill: white; -fx-padding: 10 20;" text="âœï¸ Editar Usuario" />
                        <Button fx:id="activarUsuarioButton" onAction="#handleActivarUsuario" disable="true" style="-fx-background-color: #28a745; -fx-text-fill: white; -fx-padding: 10 20;" text="âœ… Activar" />
                        <Button fx:id="desactivarUsuarioButton" onAction="#handleDesactivarUsuario" disable="true" style="-fx-background-color: #ffc107; -fx-text-fill: black; -fx-padding: 10 20;" text="â¸ï¸ Desactivar" />
                        <Button fx:id="actualizarButton" onAction="#handleActualizar" style="-fx-background-color: #6c757d; -fx-text-fill: white; -fx-padding: 10 20;" text="ðŸ”„ Actualizar" />
                        <Button fx:id="repararUsuariosButton" onAction="#handleRepararUsuarios" style="-fx-background-color: #fd7e14; -fx-text-fill: white; -fx-padding: 10 20;" text="ðŸ”§ Reparar Usuarios" />
                        
                        <Region HBox.hgrow="ALWAYS" />
                        
                        <Button fx:id="exportarButton" onAction="#handleExportar" style="-fx-background-color: #17a2b8; -fx-text-fill: white; -fx-padding: 10 20;" text="ðŸ“Š Exportar" />
                     </children>
                  </HBox>
                  
                  <!-- Filtros y bÃºsqueda -->
                  <HBox alignment="CENTER_LEFT" spacing="15.0">
                     <children>
                        <Label text="Buscar:" />
                        <TextField fx:id="buscarField" prefWidth="250.0" promptText="Buscar por nombre, usuario o email..." />
                        <Button fx:id="buscarButton" onAction="#handleBuscar" style="-fx-background-color: #007bff; -fx-text-fill: white; -fx-padding: 8 15;" text="ðŸ” Buscar" />
                        
                        <Separator orientation="VERTICAL" />
                        
                        <Label text="Filtrar por rol:" />
                        <ComboBox fx:id="filtroRolComboBox" prefWidth="150.0" promptText="Todos los roles" />
                        
                        <Label text="Estado:" />
                        <ComboBox fx:id="filtroEstadoComboBox" prefWidth="120.0" promptText="Todos" />
                        
                        <Button fx:id="limpiarFiltrosButton" onAction="#handleLimpiarFiltros" style="-fx-background-color: #6c757d; -fx-text-fill: white; -fx-padding: 8 15;" text="Limpiar" />
                     </children>
                  </HBox>
               </children>
            </VBox>
            
            <!-- Tabla de usuarios -->
            <VBox spacing="10.0" VBox.vgrow="ALWAYS">
               <children>
                  <Label style="-fx-font-size: 16px; -fx-font-weight: bold;" text="Lista de Usuarios" />
                  
                  <TableView fx:id="usuariosTable" VBox.vgrow="ALWAYS">
                     <columns>
                        <TableColumn fx:id="idColumn" prefWidth="60.0" text="ID" />
                        <TableColumn fx:id="usernameColumn" prefWidth="120.0" text="Usuario" />
                        <TableColumn fx:id="nombresColumn" prefWidth="150.0" text="Nombres" />
                        <TableColumn fx:id="apellidosColumn" prefWidth="150.0" text="Apellidos" />
                        <TableColumn fx:id="emailColumn" prefWidth="180.0" text="Email" />
                        <TableColumn fx:id="documentoColumn" prefWidth="100.0" text="Documento" />
                        <TableColumn fx:id="telefonoColumn" prefWidth="100.0" text="TelÃ©fono" />
                        <TableColumn fx:id="rolesColumn" prefWidth="120.0" text="Roles" />
                        <TableColumn fx:id="estadoColumn" prefWidth="80.0" text="Estado" />
                        <TableColumn fx:id="ultimoLoginColumn" prefWidth="130.0" text="Ãšltimo Login" />
                        <TableColumn fx:id="fechaCreacionColumn" prefWidth="130.0" text="Fecha CreaciÃ³n" />
                     </columns>
                     <placeholder>
                        <Label text="No hay usuarios para mostrar" />
                     </placeholder>
                  </TableView>
                  
                  <!-- InformaciÃ³n de paginaciÃ³n -->
                  <HBox alignment="CENTER_LEFT" spacing="10.0">
                     <children>
                        <Label fx:id="paginacionLabel" text="Mostrando 0 de 0 usuarios" />
                        <Region HBox.hgrow="ALWAYS" />
                        <Button fx:id="anteriorButton" disable="true" onAction="#handleAnterior" text="â† Anterior" />
                        <Label fx:id="paginaLabel" text="PÃ¡gina 1 de 1" />
                        <Button fx:id="siguienteButton" disable="true" onAction="#handleSiguiente" text="Siguiente â†’" />
                     </children>
                  </HBox>
               </children>
            </VBox>
            
            <!-- Panel de detalles del usuario seleccionado -->
            <VBox fx:id="detallesPanel" spacing="10.0" style="-fx-background-color: #f8f9fa; -fx-background-radius: 8; -fx-padding: 15;" visible="false">
               <children>
                  <Label style="-fx-font-size: 16px; -fx-font-weight: bold;" text="Detalles del Usuario Seleccionado" />
                  
                  <GridPane hgap="15.0" vgap="10.0">
                     <columnConstraints>
                        <ColumnConstraints hgrow="SOMETIMES" minWidth="120.0" />
                        <ColumnConstraints hgrow="SOMETIMES" minWidth="200.0" />
                        <ColumnConstraints hgrow="SOMETIMES" minWidth="120.0" />
                        <ColumnConstraints hgrow="SOMETIMES" minWidth="200.0" />
                     </columnConstraints>
                     
                     <Label style="-fx-font-weight: bold;" text="ID:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                     <Label fx:id="detalleIdLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                     
                     <Label style="-fx-font-weight: bold;" text="Usuario:" GridPane.columnIndex="2" GridPane.rowIndex="0" />
                     <Label fx:id="detalleUsernameLabel" text="-" GridPane.columnIndex="3" GridPane.rowIndex="0" />
                     
                     <Label style="-fx-font-weight: bold;" text="Nombre Completo:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                     <Label fx:id="detalleNombreCompletoLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                     
                     <Label style="-fx-font-weight: bold;" text="Email:" GridPane.columnIndex="2" GridPane.rowIndex="1" />
                     <Label fx:id="detalleEmailLabel" text="-" GridPane.columnIndex="3" GridPane.rowIndex="1" />
                     
                     <Label style="-fx-font-weight: bold;" text="Documento:" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                     <Label fx:id="detalleDocumentoLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="2" />
                     
                     <Label style="-fx-font-weight: bold;" text="TelÃ©fono:" GridPane.columnIndex="2" GridPane.rowIndex="2" />
                     <Label fx:id="detalleTelefonoLabel" text="-" GridPane.columnIndex="3" GridPane.rowIndex="2" />
                     
                     <Label style="-fx-font-weight: bold;" text="DirecciÃ³n:" GridPane.columnIndex="0" GridPane.rowIndex="3" />
                     <Label fx:id="detalleDireccionLabel" text="-" wrapText="true" GridPane.columnIndex="1" GridPane.columnSpan="3" GridPane.rowIndex="3" />
                     
                     <Label style="-fx-font-weight: bold;" text="Roles:" GridPane.columnIndex="0" GridPane.rowIndex="4" />
                     <Label fx:id="detalleRolesLabel" text="-" wrapText="true" GridPane.columnIndex="1" GridPane.columnSpan="3" GridPane.rowIndex="4" />
                     
                     <Label style="-fx-font-weight: bold;" text="Estado:" GridPane.columnIndex="0" GridPane.rowIndex="5" />
                     <Label fx:id="detalleEstadoLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="5" />
                     
                     <Label style="-fx-font-weight: bold;" text="Ãšltimo Login:" GridPane.columnIndex="2" GridPane.rowIndex="5" />
                     <Label fx:id="detalleUltimoLoginLabel" text="-" GridPane.columnIndex="3" GridPane.rowIndex="5" />
                     
                     <Label style="-fx-font-weight: bold;" text="Fecha CreaciÃ³n:" GridPane.columnIndex="0" GridPane.rowIndex="6" />
                     <Label fx:id="detalleFechaCreacionLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="6" />
                     
                     <Label style="-fx-font-weight: bold;" text="Ãšltima ActualizaciÃ³n:" GridPane.columnIndex="2" GridPane.rowIndex="6" />
                     <Label fx:id="detalleFechaActualizacionLabel" text="-" GridPane.columnIndex="3" GridPane.rowIndex="6" />
                  </GridPane>
               </children>
            </VBox>
            
         </children>
      </VBox>
   </center>
   
   <!-- Barra inferior -->
   <bottom>
      <HBox alignment="CENTER_LEFT" style="-fx-background-color: #f8f9fa; -fx-border-color: #dee2e6; -fx-border-width: 1 0 0 0; -fx-padding: 8 15;">
         <children>
            <Label fx:id="statusLabel" style="-fx-font-size: 11px; -fx-text-fill: #666666;" text="Estado: Cargando usuarios..." />
            <Region HBox.hgrow="ALWAYS" />
            <Label fx:id="timeLabel" style="-fx-font-size: 11px; -fx-text-fill: #666666;" text="" />
         </children>
      </HBox>
   </bottom>
</BorderPane>
